[gcode_macro PreHeatBed]
gcode:
  !import math
  !import time
  !start_temp=0
  !if rawparams and "T" in rawparams:
  !  target_temp=int(rawparams.split("T")[1])
  !else:
  !  target_temp=110
  !temp1 = int(target_temp/3)
  !temp2 = int(target_temp - 15)
  !emit(f"M140 {temp1}")
  !condition_met = False
  !while not codition_met:
  !  current_temp = printer["heater_bed"]["temperature"]
  !  if current_temp >= temp1:
  !    condition_met = True
  !  time.sleep(30)
  !emit(f"M140 {temp2}")
  !condition_met = False
  !while not codition_met:
  !  current_temp = printer["heater_bed"]["temperature"]
  !  if current_temp >= temp2:
  !    condition_met = True
  !  time.sleep(30)  
  !emit(f"M140 {target_temp}")
  !condition_met = False
  !while not condition_met:
  !  current_temp = printer["heater_bed"]["temperature"]
  !  if current_temp >= target_temp:
  !    condition_met = True
  !  time.sleep(30)  
